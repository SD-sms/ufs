# Setup instructions for macOS Big Sur (Darwin20) 
# Compilers: gcc-11.2.0 including gfortran-11.2.0
# MPI: openmpi/4.2.1
# Option 1 (default) : M1 chip, arm64, running natively (not using Rosetta)  
# Option 2 (uncomment if needed) Intel chip, x86_64
# 
export BASH_ENV=/opt/homebrew/opt/lmod/init/bash
source $BASH_ENV
# source /opt/homebrew/opt/lmod/init/profile

# This path should point to your HPCstack installation directory
export HPCstack=/Users/username/hpc-stack/install

# This path should point to your SRW Application directory
export SRW=/Users/username/ufs-srweather-app

module purge
# Load HPC stack 
module use ${HPCstack}/modulefiles/stack
module load hpc
module load hpc-python
#
module load hpc-gnu
module load openmpi
module load hpc-openmpi

module use ${SRW}/env
module load srw_common
module list

# Option 1 compiler paths: 
export CC=/opt/homebrew/bin/gcc
export FC=/opt/homebrew/bin/gfortran
export CXX=/opt/homebrew/bin/g++

# Option 2 compiler paths:
#export CC=/usr/local/bin/gcc
#export FC=/usr/local/bin/gfortran
#export CXX=/usr/local/bin/g++

ulimit -S -s unlimited

export MPI_CC=mpicc
export MPI_CXX=mpicxx
export MPI_FC=mpif90

export CMAKE_C_COMPILER=${MPI_CC}
export CMAKE_CXX_COMPILER=${MPI_CXX}
export CMAKE_Fortran_COMPILER=${MPI_FC}
export CMAKE_Platform=macos.gnu

export CMAKE_Fortran_COMPILER_ID="GNU"
export LDFLAGS="-L${MPI_ROOT}/lib"
export FFLAGS="-DNO_QUAD_PRECISION -fallow-argument-mismatch "

